# Default system PATH used when PATH is not set
default_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"

# Initialize empty PATH buffer
new_path=""

# Define ':' as PATH separator
IFS=":"

# Select source PATH

# Define existing PATH from environment
if [ -n "$PATH" ]
then
    source_path="$PATH"
# Define fallback to default PATH
else
    source_path="$default_path"
fi

# Build PATH containing only existing directories
for dir in $source_path
do
    [ -d "$dir" ] || continue
    if [ -z "$new_path" ]; then
        new_path="$dir"
    else
        new_path="$new_path:$dir"
    fi
done

# Export sanitized PATH
export PATH="$new_path"

# Define default pager
export PAGER=less

# Define default file creation mode
umask 022

# Use nicer PS1 for bash and busybox ash
if [ -n "$BASH_VERSION" -o "$BB_ASH_VERSION" ]
then
    PS1='\h:\w\$ '
# Use nicer PS1 for zsh
elif [ -n "$ZSH_VERSION" ]
then
    PS1='%m:%~%# '
# Set up fallback default PS1
else
    : "${HOSTNAME:=$(hostname)}"
    PS1='${HOSTNAME%%.*}:$PWD'
    [ "$(id -u)" -eq 0 ] && PS1="${PS1}# " || PS1="${PS1}\$ "
fi

# Load additional profile scripts
for script in /etc/profile.d/*.sh
do
    if [ -r "$script" ]
    then
        . "$script"
    fi
done

# Cleanup temporary variables
unset default_path dir IFS new_path script source_path
